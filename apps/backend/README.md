# @stackupfinance/backend

REST API for supporting frontend apps.

This app was initially bootstrapped from [hagopj13/node-express-boilerplate](https://github.com/hagopj13/node-express-boilerplate).

## App setup

This setup assumes that all dependencies have been installed from the project root.

### Environment variables

Create a `.env` file for local development. Variables in here will not be commited to the git repository.

```bash
$ cp ./apps/backend/.env.example ./apps/backend/.env
```

Summary of environment variables:

| Variable                                | Description                                                                                                                                                                                                                                                                                                              |
| --------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `PORT`                                  | Port number that this app will run on. Defaults to `3000`.                                                                                                                                                                                                                                                               |
| `MONGODB_URL`                           | Connection string for accessing mongo db.                                                                                                                                                                                                                                                                                |
| `JWT_SECRET`                            | Secret used to sign JWTs.                                                                                                                                                                                                                                                                                                |
| `JWT_ACCESS_EXPIRATION_MINUTES`         | Number of minutes until JWT access tokens expire and needs to be refreshed.                                                                                                                                                                                                                                              |
| `JWT_REFRESH_EXPIRATION_DAYS`           | Number of days until JWT refresh token expires after which user must login again.                                                                                                                                                                                                                                        |
| `SMTP_HOST`                             | SMTP config required for e-mail services. For testing, you can use a fake SMTP service like [Ethereal](https://ethereal.email/create). If you want to test end to end you can also use the free tier of [SendGrid](https://sendgrid.com/).                                                                               |
| `SMTP_PORT`                             | See `SMTP_HOST`.                                                                                                                                                                                                                                                                                                         |
| `SMTP_USERNAME`                         | See `SMTP_HOST`.                                                                                                                                                                                                                                                                                                         |
| `SMTP_PASSWORD`                         | See `SMTP_HOST`.                                                                                                                                                                                                                                                                                                         |
| `EMAIL_FROM`                            | The from field when sending out e-mails.                                                                                                                                                                                                                                                                                 |
| `PUSHER_APP_ID`                         | [Pusher channels](https://pusher.com/channels) config for supporting real-time features. You can use the free tier for development.                                                                                                                                                                                      |
| `PUSHER_KEY`                            | See `PUSHER_APP_ID`.                                                                                                                                                                                                                                                                                                     |
| `PUSHER_SECRET`                         | See `PUSHER_APP_ID`.                                                                                                                                                                                                                                                                                                     |
| `PUSHER_CLUSTER`                        | See `PUSHER_APP_ID`.                                                                                                                                                                                                                                                                                                     |
| `WEB3_MNEMONIC`                         | The seed phrase used to approve user operations for the paymaster. This should be the same as the one used in `@stackupfinance/contracts`.                                                                                                                                                                               |
| `WEB3_PAYMASTER`                        | Address of the paymaster. This should be the same as the one used in `@stackupfinance/contracts`.                                                                                                                                                                                                                        |
| `WEB3_RPC`                              | RPC to connect to the polygon/mumbai network. Note that the publically available RPCs listed [here](https://docs.polygon.technology/docs/develop/network-details/network/) can sometimes cause intermittent issues. You can replace it with an [Alchemy](https://www.alchemy.com/) node if you're experiencing problems. |
| `WEB3_ETHEREUM_RPC`                     | RPC for ethereum mainnet.                                                                                                                                                                                                                                                                                                |
| `WEB3_USDC`                             | USDC contract address.                                                                                                                                                                                                                                                                                                   |
| `WEB3_USDC_PRICE_FEED`                  | Contract address for Chainlink's USDC price oracle.                                                                                                                                                                                                                                                                      |
| `ALCHEMY_APP_URL`                       | Alchemy app url with key. This is required for indexing blocks.                                                                                                                                                                                                                                                          |
| `ANALYTICS_URL`                         | Url where analytics are proxied to. Defaults to Amplitude.                                                                                                                                                                                                                                                               |
| `INTERCOM_IDENTITY_VERIFICATION_SECRET` | Secret used to verify users with intercom. Not required and shouldn't block local development.                                                                                                                                                                                                                           |
| `FIAT_WYRE_API_URL`                     | Base url for [Wyre](https://www.sendwyre.com/) API                                                                                                                                                                                                                                                                       |
| `FIAT_WYRE_REFERRER_ACCOUNT_ID`         | [Wyre](https://www.sendwyre.com/) account identifier                                                                                                                                                                                                                                                                     |
| `FIAT_WYRE_API_KEY`                     | API key for [Wyre](https://www.sendwyre.com/)                                                                                                                                                                                                                                                                            |
| `FIAT_WYRE_SECRET_KEY`                  | Secret key for [Wyre](https://www.sendwyre.com/)                                                                                                                                                                                                                                                                         |
| `SENTRY_DSN`                            | Sentry dsn url to connect to error monitoring service.                                                                                                                                                                                                                                                                   |
| `FEATURE_FLAG_AIRDROP_USDC`             | Feature flag to airdrop new onboarded accounts USDC. Defaults to `false` and should only ever be `true` in development or testnet.                                                                                                                                                                                       |
| `FEATURE_FLAG_WHITELIST`                | Feature flag to enforce an invite only whitelist for sign up. Defaults to `false`.                                                                                                                                                                                                                                       |
